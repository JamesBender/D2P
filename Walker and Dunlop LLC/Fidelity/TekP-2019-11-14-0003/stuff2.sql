--select * from dbo.U_EFDSTKELIG_drvTbl where drvYtd2Accum is null

/*SELECT DISTINCT EecLocation from dbo.EmpComp where EecEEID IN ('ACRI0C00J0K0','ACRI1B0100K0','ACRI1I0000K0','ACRI1L00I0K0','ACRI1Q01K0K0','ACRI2U0180K0','ACRI2V01I0K0','ACRI3P0000K0','ACRI3U00E0K0','ACRI470140K0','ACRI4F0000K0','ACRI4L01K0K0','ACRI4O06P0K0','ACRI510000K0','ACRI810000K0','ACRI8Y0100K0','ACRI8Z00I0K0','ACRI920000K0','ACRI9H0000K0','ACRI9Q0000K0','ACRIA10080K0','ACRIA600O0K0','ACRIAO00S0K0','ACRIAP0170K0','ACRIAQ0130K0','ACRIAU0000K0','ACRIB100O0K0','ACRIBK0000K0','ACRIBN0120K0','ACRIBQ00U0K0','ACRIBT0000K0','ACRIBT0140K0','ANQ2MC0000K0','APGQ0H0000K0','AQLW6A0000K0','AWBBW800I0K0','AWFBR90000K0','BOHOW70000K0','CJO3JO005040','CTFVON000040')

select * from dbo.Location where LocCode = 'BETH'

select top 100 PthTaxCode, * FROM dbo.PTaxHist where PthTaxCode = 'MDSIT'
*/

DECLARE @EndPerControl     VARCHAR(9)
		,@FormatCode        VARCHAR(10);
SELECT @FormatCode = 'EFDSTKELIG';

SELECT @EndPerControl   = EndPerControl
    FROM dbo.U_dsi_Parameters WITH (NOLOCK)
    WHERE FormatCode = @FormatCode;



SELECT distinct pthTaxCode  -- SUM(PthCurTaxableWages) as Ytd3Accumulator 
FROM dbo.PTaxHist WITH (NOLOCK) 
JOIN dbo.TaxCode WITH (NOLOCK) 
ON PthTaxCode = CtcTaxCode 
WHERE LEFT(PthPerControl,4) = LEFT(@EndPerControl,4) 
AND PthPerControl <= @EndPerControl 
--AND PthTaxCode = STateTaxCode
 AND PthEEID IN ('ACRI0C00J0K0','ACRI1B0100K0','ACRI1I0000K0','ACRI1L00I0K0','ACRI1Q01K0K0','ACRI2U0180K0','ACRI2V01I0K0','ACRI3P0000K0','ACRI3U00E0K0','ACRI470140K0','ACRI4F0000K0','ACRI4L01K0K0','ACRI4O06P0K0','ACRI510000K0','ACRI810000K0','ACRI8Y0100K0','ACRI8Z00I0K0','ACRI920000K0','ACRI9H0000K0','ACRI9Q0000K0','ACRIA10080K0','ACRIA600O0K0','ACRIAO00S0K0','ACRIAP0170K0','ACRIAQ0130K0','ACRIAU0000K0','ACRIB100O0K0','ACRIBK0000K0','ACRIBN0120K0','ACRIBQ00U0K0','ACRIBT0000K0','ACRIBT0140K0','ANQ2MC0000K0','APGQ0H0000K0','AQLW6A0000K0','AWBBW800I0K0','AWFBR90000K0','BOHOW70000K0','CJO3JO005040','CTFVON000040')
-- GROUP BY PthEEID, PthCOID